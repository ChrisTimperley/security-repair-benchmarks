#!/bin/bash

function EXIT_CHECK {
local y=$1
local x=$y

FAILURE_EXIT_CODE=0
PASSING_EXIT_CODE=1

if [[ $y == $FAILURE_EXIT_CODE ]]; then 
	x=1; 
elif [[ $y == $PASSING_EXIT_CODE ]]; then 
	x=0; 
else 
	x=$y;
fi; 
echo $x

}

HERE_DIR=$( cd "$( dirname "${BASH_SOURCE[0]}" )" && pwd )
PATH_EXPLOIT="${HERE_DIR}/exploit"
PATH_BIN="${1:-${HERE_DIR}/source/dbuild/tools/tiffcp}"


${TEST_EXECUTION_PREFIX:-} "${PATH_BIN}" -i "${PATH_EXPLOIT}" /tmp/foo
x=$?

if [[ -e "${HERE_DIR}/BUG.cfg" ]]; then 
PATH_BIN="${1:-${HERE_DIR}/source/fbuild/tools/tiffcp}"
if [[ -e $PATH_BIN ]]; then 
${TEST_EXECUTION_PREFIX:-} "${PATH_BIN}" -i "${PATH_EXPLOIT}" /tmp/foo
x=$?
fi
fi



exit $(EXIT_CHECK $x)
